# ุชูุฑูุฑ ุชุญููู ูุดุฑูุน KUN 0X NEXUS

## 1. ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน (Project Overview)
ูุดุฑูุน **KUN 0X NEXUS** ูู ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ ุนูููุงุช ุงูู S2S (Server-to-Server) Trackingุ ููุฏู ุฅูู ูุญุงูุงุฉ ุงูุฃุญุฏุงุซ (Events) ูููุตุงุช ุงูุชุชุจุน ุงูุดููุฑุฉ (AppsFlyer, Adjust, Singular). ูุชููู ุงููุธุงู ูู ูุงุฌูุชูู ุฑุฆูุณูุชูู:
1.  **Telegram Bot**: ูุงุฌูุฉ ุชูุงุนููุฉ ูููุณุชุฎุฏููู ูุงููุฏุฑุงุก ูุชูููุฐ ุงูููุงู ูุฅุฏุงุฑุฉ ุงูุฃูุนุงุจ.
2.  **Web Dashboard**: ููุญุฉ ุชุญูู ููุจ ูุชูุฏูุฉ ูุจููุฉ ุจู FastAPI ู Vue.js ููุฅุฏุงุฑุฉ ูุงููุฑุงูุจุฉ.

## 2. ุชุญููู ุงูุจููุฉ ุงูุชุญุชูุฉ (Infrastructure Analysis)

### ุงูููุฏุณ ุงูุชููู (Tech Stack)
*   **Backend**: Python 3.x
*   **Web Framework**: FastAPI (Async)
*   **Bot Framework**: Aiogram 3.x
*   **Database**: SQLite (SQLAlchemy ORM)
*   **Frontend**: Vue.js 3 (Composition API) + TailwindCSS
*   **Process Management**: `psutil` & `asyncio`

### ูููููุฉ ุงููููุงุช (File Structure)
*   `main.py`: ููุทุฉ ุงูุฏุฎูู ุงูุฑุฆูุณูุฉ. ูุฏูุฑ ุนูููุฉ ุชุดุบูู ุงูุจูุช ูุฎุงุฏู ุงูููุจ ูุงููุฌุฏูู ูู ุขู ูุงุญุฏ.
*   `modules/`: ูุญุชูู ุนูู ุงูููุทู ุงูุจุฑูุฌู ุงูุฃุณุงุณู.
    *   `bot_client.py`: ููุฏ ุงูุจูุชุ ุชุนุฑูู ุงูุญุงูุงุช (FSM)ุ ููุนุงูุฌุฉ ุงูุฑุณุงุฆู.
    *   `s2s_engine.py`: ุงููุญุฑู ุงูุฃุณุงุณู ุงูุฐู ูููุฐ ุทูุจุงุช HTTP ููุญุงูุงุฉ ุงูุชุชุจุน. ูุฏุนู ุงูุจุฑููุณู (SOCKS/HTTP).
    *   `admin_panel.py`: ุฃุฏูุงุช ุงูุฅุฏุงุฑุฉ (ุฅุถุงูุฉ ุฃูุนุงุจุ ูุงููุฉุ ุฅุญุตุงุฆูุงุช).
    *   `database.py`: ุชุนุฑูู ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (User, Game, History...).
    *   `scheduler.py`: ุฌุฏููุฉ ุงูููุงู ุงูุชููุงุฆูุฉ.
*   `web_dashboard/`: ูููุงุช ููุญุฉ ุงูููุจ.
    *   `app.py`: ุฎุงุฏู ุงูููุจ (FastAPI) ู WebSocket.
    *   `templates/`: ูููุงุช HTML.
    *   `static/`: ูููุงุช JS/CSS.

## 3. ุงูุชุญููู ุงูุชูุตููู ููููุฏ (Codebase Deep Dive)

### ุฃ. ููุทุฉ ุงูุฏุฎูู (`main.py`)
*   ูููู ุจุชููุฆุฉ `NexusManager` ุงูุฐู ูุฑุซ ูู `NexusAdmin` (ูุงุฌูุฉ TUI).
*   ูุณุชุฎุฏู `asyncio.Queue` (log_queue) ูุฌูุงุฒ ุนุตุจู ูุฑูุฒู ูููู ุงูุณุฌูุงุช ุจูู ุงูุจูุชุ ุงููุญุฑูุ ูุงููุงุฌูุฉ.
*   ูุฏูุฑ ุชุนุฏุฏ ุงูุจูุชุงุช (Multi-Bot System) ุจูุฑุงุกุฉ ุงูุชูููุงุช ูู `.env` ููุงุนุฏุฉ ุงูุจูุงูุงุช.
*   ูุทูู ุฎุงุฏู ุงูููุจ ูู Thread ูููุตู ูุถูุงู ุนุฏู ุชุฌููุฏ ุงูุจูุช.

### ุจ. ููุทู ุงูุจูุช (`modules/bot_client.py`)
*   ูุณุชุฎุฏู `aiogram` ูุน ูุธุงู ุญุงูุงุช `FSMContext` (NexusFlow) ูุฅุฏุงุฑุฉ ุชูุงุนู ุงููุณุชุฎุฏู ุฎุทูุฉ ุจุฎุทูุฉ.
*   **ุงูุชุณุฌูู ุงูุฏููุงูููู**: ุชู ุชุนุฏูู ุงูููู ูุคุฎุฑุงู ูุงุณุชุฏุนุงุก `register_admin_handlers(dp)` ูู `admin_panel.py` ูุถูุงู ุนูู ุฃุฒุฑุงุฑ ุงูุฅุฏุงุฑุฉ.
*   **ููุฒุฉ Deep Linking**: ูุฏุนู ุฑุจุท ุงูุฃุฌูุฒุฉ ุนุจุฑ ุฑูุงุจุท ุฎุงุตุฉ (`/start LINK_DEVICE_...`).

### ุฌ. ูุญุฑู S2S (`modules/s2s_engine.py`)
*   ูุญุชูู ุนูู ูุฆุงุช ููุนุงูุฌุฉ AppsFlyer ู Adjust ู Singular.
*   **ุฅุฏุงุฑุฉ ุงูุจุฑููุณู**: ูุฏุนู ุชุฏููุฑ ุงูุจุฑููุณู (Rotation) ูุงูุชุญูู ูู ุตุญุชู ูุจู ุงูุงุณุชุฎุฏุงู.
*   **ุงููุญุงูุงุฉ ุงูุฐููุฉ**: ูุณุชุฎุฏู `calculate_smart_sleep` ูุฅุถุงูุฉ ุชุฃุฎูุฑ ุนุดูุงุฆู ูุงูุนู ุจูู ุงูุฃุญุฏุงุซ.

### ุฏ. ููุญุฉ ุงูุฅุฏุงุฑุฉ (`modules/admin_panel.py`)
*   ุชู ุฅุตูุงุญ ูุฐุง ุงูููู ุฌุฐุฑูุงู ูุคุฎุฑุงู.
*   ุชูุช ุฅุถุงูุฉ ุงูุฏุงูุฉ `open_finance_menu` ุงูุชู ูุงูุช ููููุฏุฉุ ููุง ุฃุตูุญ ุฒุฑ "ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ".
*   ูุญุชูู ุงูุขู ุนูู ุฏุงูุฉ `register_admin_handlers` ูุชุฌููุน ูู ุงููุนุงูุฌุงุช ูู ููุงู ูุงุญุฏ.
*   ุฒุฑ "๐ฆ ูุณุฎุฉ ุงุญุชูุงุทูุฉ" ุฃุตุจุญ ูุฑุชุจุทุงู ุจุงูุฏุงูุฉ `trigger_manual_backup` ุงูุชู ุชุณุชุฏุนู `send_backup_to_admin` ูู `backup_utils.py` ูุฅุฑุณุงู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูููุฏูุฑ ูุน ุงูุชุนุงูู ูุน ุบูุงุจ ุงูููุฏููู ุฃู ุงูุฃุฎุทุงุก ุจุดูู ุขูู.

### ูู. ูุงุฌูุฉ ุงูููุจ (`web_dashboard/`)
*   **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ูุดู ุชุณุฌูู ุงูุฏุฎูู ุจุณุจุจ ุชุฏุงุฎู ุงููููุฐุฌ `<form>`.
*   **ุงูุญู**: ุชู ุชุญููู ุงููููุฐุฌ ุฅูู `<div>` ูุงุณุชุฎุฏุงู Vue.js ููุชุญูู ุงููุงูู ูู ุนูููุฉ ุงูุฅุฑุณุงู (AJAX/Fetch).
*   **ุงูุชุญุณููุงุช**:
    *   ุงุณุชุจุฏุงู CDN Vue.js ุจูุณุฎุฉ ูุญููุฉ ูุถูุงู ุงูุนูู ุจุฏูู ุฅูุชุฑูุช ุฃู ูููุฏ.
    *   ุฅุฎูุงุก ุฑุณุงุฆู ุงูุฎุทุฃ ุชููุงุฆูุงู.
    *   ุฏุนู ุฒุฑ Enter ูุชุณุฌูู ุงูุฏุฎูู.

## 4. ุชุฏูู ุงูุจูุงูุงุช (Data Flow)

1.  **ุทูุจ ุงููุณุชุฎุฏู**: ูุจุฏุฃ ูู Telegram (ุฃูุฑ ุฃู ุฒุฑ).
2.  **ุงููุนุงูุฌ (Handler)**: ูุณุชูุจู `bot_client.py` ุงูุทูุจ ููุญุฏุฏ ุงูุญุงูุฉ.
3.  **ุงููุญุฑู (Engine)**: ุฅุฐุง ูุงู ุงูุทูุจ ุชูููุฐ ุนูููุฉุ ูุชู ุงุณุชุฏุนุงุก `kun_engine`.
4.  **ุงูุจุฑููุณู**: ูุชู ุงุฎุชูุงุฑ ุจุฑููุณู ูุดุท ูู ุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏู ุฃู ุงููุธุงู.
5.  **ุงูุชูููุฐ**: ูุชู ุฅุฑุณุงู ุทูุจ HTTP ูุดูุฑ ููููุตุฉ ุงููุณุชูุฏูุฉ (AF/Adjust).
6.  **ุงูุชุณุฌูู**: ูุชู ุญูุธ ุงููุชูุฌุฉ ูู `History` ูุฅุฑุณุงู ุฅุดุนุงุฑ ุนุจุฑ `log_queue` ููุธูุฑ ูู ุงูููุจ ูุงููููุณูู.

## 5. ุงูุฅุตูุงุญุงุช ุงูุฃุฎูุฑุฉ (Recent Fixes Summary)

1.  **ุฅุตูุงุญ ุชุณุฌูู ุงูุฏุฎูู (Web Dashboard Login)**:
    *   ุงููุดููุฉ: ุงูุถุบุท ุนูู ุฒุฑ ุงูุฏุฎูู ูุนูุฏ ุชุญููู ุงูุตูุญุฉ ููุง ูุณุฌู ุงูุฏุฎูู.
    *   ุงูุญู: ุฅุฒุงูุฉ ูุณู `<form>` ูููุน ุงูุณููู ุงูุงูุชุฑุงุถูุ ูุงูุงุนุชูุงุฏ ุนูู `axios/fetch` ุนุจุฑ Vue.js.

2.  **ุฅุตูุงุญ ุฒุฑ ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ (Finance Button)**:
    *   ุงููุดููุฉ: ุฒุฑ "ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ" ูู ุงูุจูุช ูุง ูุณุชุฌูุจ.
    *   ุงูุณุจุจ: ุนุฏู ูุฌูุฏ ุฏุงูุฉ ูุนุงูุฌุฉ ููู Callback `admin:finance_menu`.
    *   ุงูุญู: ุชูุช ุฅุถุงูุฉ `open_finance_menu` ูุชุณุฌูููุง ูู `register_admin_handlers`.

3.  **ุฒุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุฏูู (Manual Backup Button)**:
    *   ุงููุดููุฉ: ุงุณุชุฏุนุงุก ุบูุฑ ุตุญูุญ ุฏุงุฎู `register_admin_handlers` ูุงุณุชุฎุฏุงู `await` ูู ุฏุงูุฉ ุบูุฑ ูุชุฒุงููุฉุ ูุน ุบูุงุจ ุฏุงูุฉ `trigger_manual_backup` ูุนููุงู.
    *   ุงูุญู: ุชุนุฑูู ุฏุงูุฉ ูุณุชููุฉ `trigger_manual_backup` ูุณุฌูุฉ ุนูู `admin:backup_now`ุ ุชุชุญูู ุฃููุงู ูู ุชูุงูุฑ `send_backup_to_admin` ุซู ุชููุฐ ุนูููุฉ ุฅุฑุณุงู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูููุฏูุฑ ูุน ุฑุณุงุฆู ูุฌุงุญ/ูุดู ููุงุณุจุฉ.

4.  **ุชุญุฐูุฑุงุช ุงููููุณูู (Console Warnings)**:
    *   ุชู ุญู ุชุญุฐูุฑ Tailwind CDN ุจุฅุถุงูุฉ ุณูุฑุจุช ุชุซุจูุท.
    *   ุชู ุญู ุชุญุฐูุฑ Vue Dev Build ุจุงุณุชุฎุฏุงู ุงููุณุฎุฉ ุงูุฅูุชุงุฌูุฉ (`vue.global.prod.js`).

## 6. ุงูุฎูุงุตุฉ
ุงููุดุฑูุน ุงูุขู ูู ุญุงูุฉ ูุณุชูุฑุฉ. ุชู ุญู ุงููุดุงูู ุงูุญุฑุฌุฉ ุงูุชู ูุงูุช ุชุนูู ุงูุงุณุชุฎุฏุงู (ุงูุฏุฎูู ููููุจุ ูุฅุฏุงุฑุฉ ุงูุฃููุงู ูู ุงูุจูุช). ุงูุจููุฉ ุงูุจุฑูุฌูุฉ ูุงุจูุฉ ููุชูุณุนุ ูุน ูุตู ูุงุถุญ ูููุณุคูููุงุช ุจูู ุงููุญุฏุงุช.
